# 세차 인터널 어드민 - 대시보드 기능 명세서

## 1. 개요

### 1.1 문서 정보
| 항목 | 내용 |
|------|------|
| 문서명 | 세차 인터널 어드민 대시보드 기능 명세서 |
| 버전 | 1.0 |
| 작성일 | 2025-02-04 |
| 작성자 | ASTI (PM) |

### 1.2 화면 목적
1. **실시간 현황 모니터링**: 전체 세차 예약 현황이 정상인지, 긴급 개입이 필요한 상황인지 즉시 판단
2. **리스크 오더 관리**: 파트너사 승인 지연으로 세차가 시작되지 못하는 상황을 사전 감지하여 알림 발송 또는 매니저 권한으로 직접 개입(강제 승인/조정)

### 1.3 사용자 시나리오
- **하루 시작 시**: 전체 현황 체크, 전일 대비 이상 징후 확인
- **업무 중 상시**: 실시간 모니터링, 리스크 오더 즉시 대응

### 1.4 화면 구조
```
┌─────────────────────────────────────────────────────────────┐
│  헤더: 대시보드 타이틀 + 마지막 갱신 시간 + 새로고침 버튼      │
├─────────────────────────────────────────────────────────────┤
│  [1] 오더 현황 영역                                          │
│      좌: Funnel 시각화  |  우: 오더 상태 도넛 차트            │
├─────────────────────────────────────────────────────────────┤
│  [2] 리스크 관리 영역                                        │
│      탭 + 상세 수치  |  리스크 비율 도넛 차트                 │
├─────────────────────────────────────────────────────────────┤
│  [3] 시계열 트렌드 그래프 영역                                │
│      A: 시간대별 오더 생성량  |  B: 일별 리스크 추이           │
└─────────────────────────────────────────────────────────────┘
```

---

## 2. 공통 사항

### 2.1 데이터 갱신
| 항목 | 설명 |
|------|------|
| 갱신 방식 | 수동 (새로고침 버튼 클릭 시) |
| 조회 기준일 | 오늘 (고정) |

### 2.2 헤더 영역
| 요소 | 설명 |
|------|------|
| 타이틀 | "세차 운영 대시보드" |
| 갱신 시간 | "마지막 갱신: N초 전" 형태로 표시 |
| 새로고침 버튼 | 클릭 시 전체 데이터 즉시 갱신 |

---

## 3. [영역 1] 오더 현황

### 3.1 개요
전체 오더의 상태별 흐름과 분포를 시각화하여 현재 운영 상황을 한눈에 파악

### 3.2 레이아웃
```
┌────────────────────────────────────┬─────────────────────────┐
│                                    │                         │
│         Funnel 시각화               │    오더 상태 도넛 차트    │
│         + 취소 유형 상세            │                         │
│                                    │                         │
└────────────────────────────────────┴─────────────────────────┘
```

### 3.3 Funnel 시각화

#### 3.3.1 구조
```
                    전체 오더
                       │
         ┌─────────────┼─────────────┐
         ▼             ▼             ▼
       발행          예약        취소된 오더
         │             │             │
         └──────┬──────┘             ▼
                ▼              [취소 유형 상세]
             수행 중
                │
                ▼
            수행 완료
                │
        ┌───────┴───────┐
        ▼               ▼
    적시수행         지연수행
```

#### 3.3.2 데이터 필드 정의

**오더 상태**
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| total_orders | 전체 오더 수 | Integer |
| issued | 발행 오더 수 | Integer |
| reserved | 예약 오더 수 | Integer |
| in_progress | 수행 중 오더 수 | Integer |
| cancelled | 취소된 오더 수 | Integer |
| completed | 수행 완료 오더 수 | Integer |
| completed_on_time | 적시수행 오더 수 | Integer |
| completed_delayed | 지연수행 오더 수 | Integer |

**취소 유형 상세**
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| cancel_type_change | 변경취소 수 | Integer |
| cancel_type_no_reservation | 미예약취소 수 | Integer |
| cancel_type_no_show | 노쇼취소 수 | Integer |
| cancel_type_agent | 수행원취소 수 | Integer |
| cancel_type_rain | 우천취소 수 | Integer |

#### 3.3.3 인터랙션
| 요소 | 클릭 시 동작 |
|------|-------------|
| 전체 오더 | 전체 오더 목록 페이지로 이동 |
| 발행 | 발행 상태 필터링된 목록으로 이동 |
| 예약 | 예약 상태 필터링된 목록으로 이동 |
| 수행 중 | 수행 중 상태 필터링된 목록으로 이동 |
| 취소된 오더 | 취소 상태 필터링된 목록으로 이동 |
| 수행 완료 | 수행 완료 상태 필터링된 목록으로 이동 |
| 적시수행 | 적시수행 필터링된 목록으로 이동 |
| 지연수행 | 지연수행 필터링된 목록으로 이동 |
| 각 취소 유형 | 해당 취소 유형으로 필터링된 목록으로 이동 |

### 3.4 오더 상태 도넛 차트

#### 3.4.1 구성
전체 오더를 아래 5개 상태로 분류하여 비율 표시

| 상태 | 색상 (권장) | 설명 |
|------|------------|------|
| 발행 | Blue | 발행되었으나 아직 예약되지 않은 오더 |
| 예약 | Green | 예약 완료된 오더 |
| 수행 중 | Yellow | 현재 수행 중인 오더 |
| 취소 | Gray | 취소된 오더 |
| 수행 완료 | Purple | 수행 완료된 오더 |

#### 3.4.2 표시 정보
- 차트 중앙: 전체 오더 수
- 각 세그먼트: 상태명 + 건수 + 비율(%)
- 범례: 차트 우측 또는 하단에 표시

#### 3.4.3 인터랙션
| 요소 | 동작 |
|------|------|
| 세그먼트 호버 | 툴팁으로 상세 정보 표시 (상태명, 건수, 비율) |
| 세그먼트 클릭 | 해당 상태로 필터링된 오더 목록으로 이동 |

---

## 4. [영역 2] 리스크 관리

### 4.1 개요
리스크 유형별(위생장애, 고객피드백(ML)_긴급, 초장기미세차) 오더 현황을 탭으로 구분하여 상세 모니터링

### 4.2 레이아웃
```
┌─────────────────────────────────────────┬─────────────────────┐
│                                         │                     │
│  [탭] 위생장애 | ML긴급 | 초장기미세차     │  리스크 비율        │
│                                         │  도넛 차트          │
│  ┌─ 선택된 탭 상세 내용 ───────────────┐ │                     │
│  │                                     │ │                     │
│  │  오더 상태 수치                      │ │                     │
│  │  취소 유형 상세                      │ │                     │
│  │  수행 완료 상세                      │ │                     │
│  │                                     │ │                     │
│  └─────────────────────────────────────┘ │                     │
│                                         │                     │
└─────────────────────────────────────────┴─────────────────────┘
```

### 4.3 탭 구성

#### 4.3.1 탭 헤더
| 탭명 | 필터 조건 | 배지 표시 |
|------|----------|----------|
| 위생장애 | 발행유형 = '위생장애' | 해당 유형 전체 건수 |
| 고객피드백(ML)_긴급 | 발행유형 = '고객피드백(ML)_긴급' | 해당 유형 전체 건수 |
| 초장기미세차 | 발행유형 = '초장기미세차' | 해당 유형 전체 건수 |

### 4.4 탭별 상세 내용

각 탭은 동일한 구조로 아래 정보를 표시

#### 4.4.1 오더 상태 수치
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| risk_total | 해당 리스크 유형 전체 오더 수 | Integer |
| risk_issued | 발행 오더 수 | Integer |
| risk_reserved | 예약 오더 수 | Integer |
| risk_in_progress | 수행 중 오더 수 | Integer |

#### 4.4.2 취소된 오더 상세
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| risk_cancelled_total | 취소된 오더 총 수 | Integer |
| risk_cancel_change | 변경취소 수 | Integer |
| risk_cancel_no_reservation | 미예약취소 수 | Integer |
| risk_cancel_no_show | 노쇼취소 수 | Integer |
| risk_cancel_agent | 수행원취소 수 | Integer |
| risk_cancel_rain | 우천취소 수 | Integer |

#### 4.4.3 수행완료 상세
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| risk_completed_total | 수행완료 총 수 | Integer |
| risk_completed_on_time | 적시수행 수 | Integer |
| risk_completed_delayed | 지연수행 수 | Integer |

#### 4.4.4 예시 데이터 (위생장애)
```
위생장애 전체: 16건

[오더 상태]
발행: 3 | 예약: 8 | 수행 중: 5

[취소된 오더: 1건]
변경취소: 1 | 미예약취소: 0 | 노쇼취소: 0 | 수행원취소: 0 | 우천취소: 0

[수행완료: 120건]
적시수행: 100 | 지연수행: 20
```

#### 4.4.5 인터랙션
| 요소 | 클릭 시 동작 |
|------|-------------|
| 탭 | 해당 리스크 유형 상세 내용으로 전환 |
| 각 수치 | 해당 조건으로 필터링된 오더 목록으로 이동 |

### 4.5 리스크 비율 도넛 차트

#### 4.5.1 구성
전체 오더 대비 각 리스크 유형의 비율 표시

| 구분 | 색상 (권장) | 설명 |
|------|------------|------|
| 일반 오더 | Light Gray | 리스크 유형에 해당하지 않는 오더 |
| 위생장애 | Red | 위생장애 오더 |
| 고객피드백(ML)_긴급 | Orange | ML 긴급 오더 |
| 초장기미세차 | Yellow | 초장기미세차 오더 |

#### 4.5.2 계산 로직
```
일반 오더 = 전체 오더 - (위생장애 + ML긴급 + 초장기미세차)

* 하나의 오더에는 하나의 발행유형만 존재 (중복 없음)
```

#### 4.5.3 표시 정보
- 차트 중앙: 전체 오더 수
- 각 세그먼트: 유형명 + 건수 + 비율(%)
- 범례: 차트 우측 또는 하단에 표시

#### 4.5.4 인터랙션
| 요소 | 동작 |
|------|------|
| 세그먼트 호버 | 툴팁으로 상세 정보 표시 |
| 세그먼트 클릭 | 해당 리스크 유형 탭 활성화 |

---

## 5. [영역 3] 시계열 트렌드 그래프

### 5.1 개요
시간 흐름에 따른 오더 및 리스크 추이를 시각화하여 이상 징후 조기 감지

### 5.2 레이아웃
```
┌─────────────────────────────────┬─────────────────────────────────┐
│                                 │                                 │
│  [A] 시간대별 오더 생성량            │   [B] 일별 리스크 유형별 추이         │
│      (오늘 vs 어제)               │                                  │
│                                 │                                 │
└─────────────────────────────────┴─────────────────────────────────┘
```

### 5.3 그래프 A: 시간대별 오더 생성량

#### 5.3.1 목적
오늘 오더 생성량을 어제와 비교하여 이상 징후 감지

#### 5.3.2 차트 유형
라인 차트 (Line Chart)

#### 5.3.3 데이터 필드
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| hour | 시간대 (0~23) | Integer |
| today_count | 오늘 해당 시간대 오더 생성 수 | Integer |
| yesterday_count | 어제 해당 시간대 오더 생성 수 | Integer |

#### 5.3.4 시각화 요소
| 요소 | 설명 |
|------|------|
| X축 | 시간대 (0시 ~ 23시, 또는 운영 시간대만) |
| Y축 | 오더 생성 건수 |
| 라인 1 | 오늘 (실선, Primary Color) |
| 라인 2 | 어제 (점선, Secondary Color) |
| 현재 시간 | 세로 점선으로 현재 시간 표시 |

#### 5.3.5 인터랙션
| 요소 | 동작 |
|------|------|
| 라인 포인트 호버 | 툴팁: 시간대, 오늘 건수, 어제 건수, 증감률 |
| 범례 클릭 | 해당 라인 표시/숨김 토글 |

### 5.4 그래프 B: 일별 리스크 유형별 추이

#### 5.4.1 목적
리스크 유형별 건수 추이를 파악하여 증가 패턴 조기 감지

#### 5.4.2 차트 유형
스택 영역 차트 (Stacked Area Chart) 또는 멀티 라인 차트

#### 5.4.3 데이터 필드
| 필드명 | 설명 | 데이터 타입 |
|--------|------|------------|
| date | 날짜 | Date |
| hygiene_count | 위생장애 건수 | Integer |
| ml_urgent_count | 고객피드백(ML)_긴급 건수 | Integer |
| long_term_count | 초장기미세차 건수 | Integer |

#### 5.4.4 시각화 요소
| 요소 | 설명 |
|------|------|
| X축 | 날짜 (최근 7일 고정) |
| Y축 | 리스크 오더 건수 |
| 영역 1 | 위생장애 (Red 계열) |
| 영역 2 | 고객피드백(ML)_긴급 (Orange 계열) |
| 영역 3 | 초장기미세차 (Yellow 계열) |

#### 5.4.5 인터랙션
| 요소 | 동작 |
|------|------|
| 영역 호버 | 툴팁: 날짜, 각 유형별 건수 |
| 범례 클릭 | 해당 유형 표시/숨김 토글 |

---

## 6. API 명세 (Backend)

### 6.1 대시보드 전체 데이터 조회

#### Endpoint
```
GET /api/v1/admin/dashboard
```

#### Request Parameters
| 파라미터 | 타입 | 필수 | 설명 |
|---------|------|------|------|
| - | - | - | 파라미터 없음 (오늘 기준 고정) |

#### Response
```json
{
  "success": true,
  "data": {
    "updated_at": "2025-02-04T14:30:00Z",
    "order_status": {
      "total": 600,
      "issued": 300,
      "reserved": 200,
      "in_progress": 100,
      "cancelled": {
        "total": 50,
        "change": 10,
        "no_reservation": 30,
        "no_show": 5,
        "agent": 5,
        "rain": 0
      },
      "completed": {
        "total": 300,
        "on_time": 350,
        "delayed": 50
      }
    },
    "risk_management": {
      "hygiene": {
        "total": 16,
        "issued": 3,
        "reserved": 8,
        "in_progress": 5,
        "cancelled": {
          "total": 1,
          "change": 1,
          "no_reservation": 0,
          "no_show": 0,
          "agent": 0,
          "rain": 0
        },
        "completed": {
          "total": 120,
          "on_time": 100,
          "delayed": 20
        }
      },
      "ml_urgent": {
        "total": 27,
        "issued": 2,
        "reserved": 15,
        "in_progress": 10,
        "cancelled": {
          "total": 7,
          "change": 0,
          "no_reservation": 0,
          "no_show": 0,
          "agent": 0,
          "rain": 0
        },
        "completed": {
          "total": 87,
          "on_time": 82,
          "delayed": 5
        }
      },
      "long_term": {
        "total": 70,
        "issued": 25,
        "reserved": 15,
        "in_progress": 20,
        "cancelled": {
          "total": 23,
          "change": 0,
          "no_reservation": 15,
          "no_show": 1,
          "agent": 2,
          "rain": 0
        },
        "completed": {
          "total": 46,
          "on_time": 45,
          "delayed": 1
        }
      }
    }
  }
}
```

### 6.2 시간대별 오더 생성량 조회

#### Endpoint
```
GET /api/v1/admin/dashboard/hourly-orders
```

#### Request Parameters
| 파라미터 | 타입 | 필수 | 설명 |
|---------|------|------|------|
| - | - | - | 파라미터 없음 (오늘/어제 기준 고정) |

#### Response
```json
{
  "success": true,
  "data": {
    "today": "2025-02-04",
    "yesterday": "2025-02-03",
    "hourly_data": [
      { "hour": 0, "today": 5, "yesterday": 3 },
      { "hour": 1, "today": 2, "yesterday": 4 },
      ...
      { "hour": 23, "today": 8, "yesterday": 10 }
    ]
  }
}
```

### 6.3 일별 리스크 추이 조회

#### Endpoint
```
GET /api/v1/admin/dashboard/daily-risks
```

#### Request Parameters
| 파라미터 | 타입 | 필수 | 설명 |
|---------|------|------|------|
| - | - | - | 파라미터 없음 (오늘 기준, 최근 7일 고정) |

#### Response
```json
{
  "success": true,
  "data": {
    "period": {
      "start": "2025-01-29",
      "end": "2025-02-04"
    },
    "daily_data": [
      {
        "date": "2025-01-29",
        "hygiene": 12,
        "ml_urgent": 20,
        "long_term": 55
      },
      {
        "date": "2025-01-30",
        "hygiene": 14,
        "ml_urgent": 22,
        "long_term": 60
      },
      ...
    ]
  }
}
```

---

## 7. 용어 정의

| 용어 | 정의 |
|------|------|
| 오더 | 세차 서비스 요청 건 |
| 발행 | 오더가 생성(발행)되었으나 아직 예약이 완료되지 않은 상태 |
| 예약 | 파트너사 승인 완료 후 예약이 확정된 상태 |
| 수행 중 | 에이전트가 세차를 진행 중인 상태 |
| 수행 완료 | 세차가 완료된 상태 |
| 적시수행 | 예정된 시간 내에 완료된 수행 |
| 지연수행 | 예정된 시간을 초과하여 완료된 수행 |
| 위생장애 | 위생 관련 이슈가 발생한 오더 |
| 고객피드백(ML)_긴급 | ML 모델이 긴급으로 분류한 고객 피드백이 있는 오더 |
| 초장기미세차 | 장기간 세차가 이루어지지 않은 차량의 오더 |

---

## 8. 변경 이력

| 버전 | 날짜 | 작성자 | 변경 내용 |
|------|------|--------|----------|
| 1.0 | 2025-02-04 | ASTI | 최초 작성 |