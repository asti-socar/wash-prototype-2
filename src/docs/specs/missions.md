# 미션 정책 관리 기능 명세서

## 1. 개요
- **화면명**: 미션 정책 관리
- **목적**: 반복되거나 대량으로 발생하는 특수 과업을 '정책'으로 정의하고, 해당 정책을 수행해야 할 차량들을 일괄 할당 및 관리하여 운영 효율성을 높입니다.
- **주요 구조**: `미션 정책(Parent)` - `대상 차량(Child)`의 1:N 구조.

## 2. 화면 구성 및 기능

### 2.1 검색 및 필터 (Search & Filter)
상단 카드 영역에서 정책 리스트를 필터링하며, 선택된 조건은 하단에 **칩(Chip)** 형태로 노출됩니다.

#### 검색 조건
| 구분 | 항목 | 타입 | 동작 정의 |
| :--- | :--- | :--- | :--- |
| **기간** | 등록일 | DatePicker | 시작일 ~ 종료일 범위 조회 |
| **필터** | 상태 | 선택(Select) | **옵션**: 전체, 활성, 비활성 |

#### UI 동작
- **필터 칩**: 적용된 날짜 범위 및 상태 값이 칩으로 나열되며, `X` 버튼 클릭 시 해당 조건만 초기화.
- **필터 초기화**: 버튼 클릭 시 모든 입력값 및 칩을 제거하고 전체 목록 조회.

### 2.2 미션 정책 목록 (Main List)
등록된 미션 정책을 테이블 형태로 조회합니다.

- **페이지네이션**: 페이지당 **40건** 기준.
- **정렬**: 헤더 클릭 시 오름차순/내림차순 정렬 (기본값: 등록일시 내림차순).
- **진입점**: '미션 정책 등록' 버튼 클릭 시 신규 등록 드로어 호출.

#### 컬럼 정의
| 헤더명 | 정렬 | 데이터 정의 및 로직 |
| :--- | :--- | :--- |
| **ID** | O | 정책 고유 식별자 |
| **미션 제목** | O | 정책의 제목 (`title` 필드) |
| **금액** | O | 3자리 콤마 포맷 (`{금액}원`) |
| **대상 차량수** | O | **[파생 데이터]** 해당 정책에 할당된 전체 차량 수 (`{N}대`) |
| **수행 완료수** | O | **[파생 데이터]** 할당된 차량 중 상태가 'completed'인 차량 수 (`{N}대`) |
| **진행률(%)** | O | **[파생 데이터]** `(수행 완료수 / 대상 차량수) * 100` (반올림 처리) |
| **상태** | O | **[배지]** 활성(Green) / 비활성(Default) |
| **등록일시** | O | `YYYY-MM-DD` 형식 |

### 2.3 신규 미션 정책 등록 (Drawer)
목록 상단의 '미션 정책 등록' 버튼(+) 클릭 시 호출됩니다.

#### 입력 필드
- **미션 제목**: 텍스트 입력 (최대 20자, 필수 항목).
- **미션 내용**: 여러 줄 텍스트 입력(Textarea, 최대 500자).
- **미션 금액**: 숫자 입력 (최소 0원).
- **상태**: 활성 / 비활성 선택 (기본값: 활성).
- **옵션**: "수행 시 증빙 사진 필수" 체크박스 (Boolean).

### 2.4 정책 상세 및 차량 관리 (Drawer)
목록의 행(Row) 클릭 시 우측 드로어가 열립니다.

#### A. 정책 정보 수정 섹션
- **타이틀**: "미션 정책 상세"
- **기능**: **미션 제목**, **미션 내용**, 금액, 상태, 사진 필수 여부를 수정하고 '정책 저장' 버튼으로 업데이트.
- **삭제**: '정책 삭제' 버튼 제공. 삭제 시 **연관된 차량 할당 내역도 함께 삭제**된다는 경고(Confirm) 후 처리.

#### B. 대상 차량 관리 섹션

**1. 차량 일괄 추가 (Bulk Input)**
- **입력 방식**: 텍스트 영역(Textarea)에 차량번호 입력.
- **구분자 로직**: **콤마(,)** 또는 **줄바꿈(Enter)**을 기준으로 텍스트를 분리하여 다수의 차량을 한 번에 목록에 추가.
- **초기 상태**: 추가된 차량의 수행 상태는 '대기(pending)'로 설정됨.

**2. 할당된 차량 목록 (Table)**
- **차량번호**: 대상 차량 번호.
- **수행 상태**: **[배지]** 완료(Green) / 대기(Orange).
- **연결된 오더**:
  - 수행 완료 시: 오더 ID 노출 및 링크(새 창 이동).
  - 미완료 시: `-` 표기.
- **완료일**: `YYYY-MM-DD` 형식.
- **관리(Actions)**: 상태가 '대기'인 경우에만 **삭제(Trash Icon)** 버튼 노출 (할당 취소).

## 3. 비즈니스 로직

### 3.1 오더 연동 정책
- **자동 포함**: 특정 차량에 대해 세차 오더가 발행될 때, 해당 차량번호가 할당된 '대기(pending)' 상태의 미션 정책이 있다면 오더의 미션 목록에 자동으로 포함됩니다.
- **상태 동기화**: 연동된 오더가 '완료' 상태로 변경되면, 해당 정책 하위의 차량 수행 상태도 '완료(completed)'로 자동 업데이트됩니다.
- **진행률 갱신**: 차량의 상태 변경 시, 정책 목록의 진행률 및 수행 완료수도 즉시 재계산되어야 합니다.
