# 발행 유형 정책 관리 (Order Type Policy Specification)

## 1. 개요
- **화면명**: 발행 유형 책관리
- **목적**: 관리되고 있는 오더의 현황을 파악하고 새로운 발행 유형을 등록합니다.
- **특징**: 이 화면은 정책을 등록하거나 수정하는 기능을 제공합니다.
- **주요 기능**: 발행 유형 목록 조회, 발행 유형 등록

## 2. 정책 목록 (리스트 화면)

### 2.1 UI 구성 및 동작
* **컬럼 노출**: (정책ID, 순위, 오더 구분, 발행 유형, 세차 유형, 존유형, 블락시간, 발행여부, 파트너 유형) 먼저 보여주고 나머지는 상세 조회에서 처리
* **목록 노출**: 페이지네이션 없이 한 페이지에 모든 데이터를 노출하며, 세로 스크롤 방식을 사용합니다.
* **고정 헤더 (Sticky Header)**: 스크롤 시에도 테이블의 최상단 헤더는 고정되어 데이터의 속성을 식별할 수 있어야 합니다.
* **기본 정렬**: 페이지 진입 시 **'발행 유형 ID'**를 기준으로 오름차순(ASC) 정렬되어 나타납니다.
* **엑셀 다운로드**: 현재 리스트에 노출된 전체 정책 데이터를 CSV 또는 Excel 파일로 추출하는 기능을 제공합니다.

### 2.2 검색 및 필터 로직

---

## 3. 상세 정보 및 편집 그리고 생성 (Drawer)

* 행 클릭 시 Drawer 오픈.
* '수정' 버튼 클릭 시 모든 필드를 편집 가능한 폼(Input, Select)으로 전환.
* Drawer 내의 모든 입력 필드 라벨 옆에는 **도움말 아이콘(?)**이 위치하며, 마우스 오버 시 상세 점수 매핑표나 산출 공식이 포함된 **툴팁(Tooltip)**이 나타나야 합니다.
* 하나의 Drawer를 '추가'와 '수정' 모드에서 공통으로 사용하되, 데이터 특성에 따른 로직을 적용해야 함

### 3.1 탭 구성

1. **상세 정보**: 정책의 모든 세부 설정값 입력 및 자동 계산 결과 확인.
2. **API 상세**: 해당 정책이 백엔드/AI 모델과 통신할 때 사용하는 JSON 데이터 스키마 예시 노출.
3. **변경 이력**: 수정 시점, 수정자 아이디, 구체적인 데이터 변경 내역(From/To)을 역순으로 표시.

### 3.2 입력 필드 및 제약 조건

| 항목 | 타입 | 제약 사항 및 설명 |
| --- | --- | --- |
| **발행 유형 명칭** | Input | 필수 입력, 시스템 내 중복 불가능 (Unique 체크). |
| **발행 유형 점수** | Input | 1~9 사이의 숫자만 허용. 동일한 '오더 구분' 내에서 중복 금지. |
| **설명** | Textarea | 최대 100자 이내 입력. |
| **오더 발행 여부** | Select | Y/X 선택. 리스트와 상세 화면에서 배지(Badge) 형태로 강조. |
| **wait_time 취소 여부** | Select | Y/X 선택. 리스트와 상세 화면에서 배지(Badge) 형태로 강조. |
| **wait_time** | Input | 시간 단위 숫자 입력. |
| **미션등록 여부** | Select | Y/N 선택. |
| **가산점** | Input | 숫자 입력 가능 (초기값 0 또는 Null). |

- Select 필드 (드롭다운):
    * 셰어링 유형: [단기, 시승]
    * 오더 구분: [정규, 변경, 수시, 특별]
    * 세차 유형: [협의, 특수, 내외부, 내부, 외부, 물세차, 라이트]
    * 존유형: [일반존, 주기세차존, 현장세차 불가존, 시승존, 캠핑카]
    * 파트너 유형: [현장, 입고]
    * 블락 유형: [세차블락, 장애블락]
       
    - Input 필드:
         
        * 블락 시간: 숫자 (분 단위)

        

### 3.3 변경 이력 관리
* 저장 시 로직: 
    - version을 +1 시킴.
    - 현재 시간과 'Ops Admin' 아이디를 수정자로 기록.
    - history 배열에 변경된 내역(어떤 필드가 바뀌었는지)을 push함.

### 3.4 tooltip
1. UI 구성:
- 모든 입력 필드(Select, Input)의 라벨 우측에 'lucide-react'의 'HelpCircle' 아이콘(크기 14px, 색상 #6B778C)
- 아이콘에 마우스를 올리면 해당 필드에 대한 상세 설명이 담긴 툴팁이 나타나도록 구현

2. 필드별 설명 문구 (데이터 정의):
- 발행 유형 점수: "동일 오더 구분 그룹 내 우선순위를 결정하는 1~9 사이의 값입니다."
- 가산점: "기본 점수 외에 운영 판단에 따라 부여하는 추가 점수입니다. (1점당 총점 10점 가산)"
- 중요도 총점: "공식: (세차*10000) + (구분*1000) + (유형점수*100) + (가산점*10) + 존유형"
- 블락 시간: "차량의 예약이 제한되는 시간(분 단위)입니다."
- wait_time: "오더 발행 전 대기하는 시간(시간 단위)입니다."
- 대상 차량: "특정 차량 ID나 존 ID를 컴마(,)로 구분하여 입력하세요."

---

## 4. 핵심 자동화 로직 (Technical Logic)

### 4.2 오더 중요도 총점 산출

사용자가 항목을 선택하거나 가산점을 입력할 때마다 FE에서 실시간으로 계산하여 보여줍니다.

* **공식**: 
* **중요도 순위**: 전체 정책 데이터의 총점을 비교하여 1위부터 순위를 매기며, 데이터 추가/수정 시 전체 순위가 재계산되어야 합니다.

#### [중요도 점수 매핑표]

* **세차 유형**: 협의(8), 특수(7), 내외부(5), 내부(4), 외부(3), 물세차(2), 라이트(1)
* **오더 구분**: 변경(9), 수시(8), 긴급(7), 정규(5), 특별(3)
* **존 유형**: 일반존(8), 주기세차존(6), 현장세차 불가존(4), 시승존/캠핑카(0)
* **중요도 점수**: TotalScore = (세차 유형점수 \times 10000) + (오더 구분점수 \times 1000) + (발행 유형점수 \times 100) + (가산점 \times 10) + 존유형점수$$
* **순위**: 자동 산출, useMemo를 활용하여 전체 리스트를 총점 내림차순으로 정렬하고, 현재 항목의 순위를 실시간으로 표시해줘. (데이터 추가/수정 시 전체 순위 재계산 필수)

### 4.2 파트너 유형 자동 결정

운영자의 수기 선택이 불가능하며, 아래 조건에 따라 시스템이 판단합니다.

* **[입고] 결정 조건**:
1. '존유형'이 **현장세차 불가존**인 경우
2. 또는, '세차 유형'이 **특수** 또는 **협의**인 경우


* **[현장] 결정 조건**: 위 '입고' 조건에 해당하지 않는 모든 경우

### 4.3 블락 정책 자동 합산

블락 관련 세부 시간을 입력하면 **총 블락 시간**이 분(minute) 단위로 자동 계산됩니다.

* **입력 항목**: 쿠션(전), 핸들러(배차), 세차수행시간, 쿠션(후), 핸들러(반차)
* **계산 결과**: 위 5개 항목의 합계를 '총 블락 시간' 필드(Read-only)에 표시합니다.

---

## 5. 버전 관리 및 감사 로그 (Audit Log)

### 5.1 업데이트 정책

* **버전 증가**: 정책 저장(수정) 시 `version` 숫자는 기존 값에서 +1씩 자동 증가합니다.
* **이력 기록**: 수정 완료 시 아래 정보를 `history` 데이터셋에 추가해야 합니다.
* 수정 일시 (YYYY-MM-DD HH:mm:ss)
* 수정자 아이디 (예: 'Ops Admin')
* 변경 내역: 어떤 필드가 어떤 값에서 어떤 값으로 바뀌었는지 명시 (예: `가산점: 0 -> 10`)



### 5.2 유효성 검사 (Save Validation)

* 저장 버튼 클릭 시 '발행 유형 명칭'의 중복 여부를 전체 리스트에서 1차로 확인합니다.
* 동일한 '오더 구분' 내에서 '발행 유형 점수'가 겹치지 않는지 최종 확인 후 저장을 완료합니다.

---

## 6. 데이터 필드 정의:
- 각 데이터 객체는 다음 필드를 반드시 포함해야 함:
  * 정책 식별자(ID): 고유한 값 
  * 셰어링 유형: 
    * 단기: 
    * 시승: 시승 서비스 차량의 세차 
  * 오더 구분: 정규, 변경, 수시, 특별 
  * 발행 유형: 
    - 위생장애, 고객피드백(ML)_긴급, 초장기 미세차, 주기세차, 고객피드백(ML), 반납사진(ML), 미션해들, 특수세차, 협의세차, 재세차, 수시세차, BMW, 랜지로버, 포르쉐, 캠핑카 
  * 세차 유형: 협의, 특수, 내외부, 내부, 외부, 물세차, 라이트
  * 존유형: 일반존, 주기세차존, 현장세차 불가존, 시승존 캠핑카 
  * 오더 발행 여부: Y/N
  * 중요도 정보: 
    * 순위: 유형이 추가되면 순서가 재 계산 되어야 함 
    * 중요도 총점
    * 세차 유형 점수 
    * 오더 구분 점수 
    * 발행 유형 점수 
    * 존유형 점수
    * 가산점(bonusPoints)' : 초기값은 0 또는 null 
  * 파트너 유형: 현장, 입고
  * 블락 정책
    * 블락 유형: 세차블락, 장애블락
    * 블락 시간
    * 쿠션(전):
    * 핸들러(배차):
    * 세차수행시간:
    * 쿠션(후):
    * 핸들러(반차):
  * 미션등록 여부: Y/N
  * wait_time
  * wait_time 취소 여부
  * 설명: 
  * 버전 정보: version (숫자)
  * 수정 이력: history (배열 - { date, user, changes } 포함)








