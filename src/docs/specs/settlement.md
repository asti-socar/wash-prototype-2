# 합의 요청 관리 기능 명세서

## 1. 개요
- **화면명**: 합의 요청 관리
- **목적**: 세차 수행 중 발견된 특이사항(오염 심각, 추가 과업 등)으로 인해 파트너사가 추가 비용을 요청할 경우, 이를 검토하고 합의(승인/반려/네고)하는 프로세스를 관리합니다.
- **주요 기능**: 요청 목록 조회, 사유 및 현장 사진 확인, 청구 금액 조정, 승인 및 반려 처리.

## 2. 화면 구성 및 기능

### 2.1 합의 요청 목록 (List)
파트너사로부터 접수된 합의 요청 건들을 테이블 형태로 조회합니다.

- **페이지네이션**: 페이지당 **40건** 기준.
- **정렬**: 헤더 클릭 시 오름차순/내림차순 정렬 지원.
- **진입점**: 별도의 검색/필터 기능 없이 전체 목록을 기본 조회합니다.

#### 컬럼 정의
| 헤더명 | 정렬 | 데이터 정의 및 로직 |
| :--- | :--- | :--- |
| **오더 ID** | O | |
| **차량번호** | O | |
| **차종** | O | |
| **존이름** | O | |
| **파트너명** | O | 요청을 보낸 파트너사 명칭 |
| **요청 시간** | O | `YYYY-MM-DD HH:mm` 형식 |
| **상태** | O | **[배지]**<br>- **요청**: Warn (Orange)<br>- **수락**: Ok (Green)<br>- **거절**: Danger (Red)<br>- **기타**: Default (Gray) |

### 2.2 합의 요청 상세 (Drawer)
목록의 행(Row) 클릭 시 우측 드로어가 열리며, 상세 정보를 확인하고 의사결정을 수행합니다.

- **타이틀**: `합의 요청 상세 - {요청ID}` (예: A-1001)

#### A. 요청 정보 섹션
- **기본 정보**: 오더 ID, 차량 정보(번호 및 차종), 파트너명.
- **요청 사유**: 파트너사가 입력한 사유 텍스트.
- **세차 항목**: 추가 수행이 필요한 항목 리스트 (예: 내부세차, 특수오염제거).
- **청구 금액**:
  - **상태 = '요청'**: 수정 가능한 **숫자 입력(Input)** 필드로 노출. (운영자가 금액을 수정하여 승인 가능 - 네고)
  - **그 외 상태**: 수정 불가능(Disabled) 상태로 노출.
- **코멘트**: 파트너사 코멘트 또는 처리 결과 메시지.

#### B. 현장 사진 섹션
- **이미지**: 세차 전 상태를 증빙하는 현장 사진 미리보기 영역. (현재 Placeholder 제공)

#### C. 승인 및 반려 처리 (Footer/Action)
상태가 **'요청'**일 경우에만 하단 액션 버튼이 노출됩니다. 그 외 상태에서는 '닫기' 버튼만 제공됩니다.

1.  **승인 (Approve)**
    - **트리거**: '승인' 버튼 클릭.
    - **로직**: 현재 입력된 '청구 금액'으로 비용을 확정하며, 상태를 **'수락'**으로 변경.
2.  **반려 (Reject)**
    - **트리거**: '반려' 버튼 클릭.
    - **UI 동작**: 드로어 내부 최하단에 **반려 사유 입력 영역(Card)**이 활성화됨 (별도 팝업 아님).
    - **반려 확정**: 사유 입력 후 '반려 확정' 버튼 클릭 시, 상태를 **'거절'**로 변경하고 입력된 사유를 코멘트에 저장.
    - **취소**: 반려 입력 모드를 종료하고 상세 화면 유지.

## 3. 비즈니스 로직

### 3.1 상태 전이 및 수정 제한
- **수정 권한**: 오직 **'요청'** 상태에서만 청구 금액 수정 및 승인/반려 처리가 가능합니다.
- **종결 처리**: **'수락'** 또는 **'거절'** 상태로 변경된 건은 최종 상태로 간주하여, 더 이상 금액이나 상태를 변경할 수 없습니다.

### 3.2 금액 합의 (Negotiation)
- 운영자는 파트너사가 요청한 초기 금액을 확인 후, 합의된 금액으로 **Input 필드를 수정한 뒤 승인**할 수 있습니다. 시스템은 승인 시점의 금액을 최종 합의 금액으로 저장합니다.